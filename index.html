<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TreeOfLifa - Naturliga Luffasvampar</title>
<script src="https://js.stripe.com/v3/"></script>
<style>
/* --- Din befintliga CSS här (oförändrad) --- */
/* Jag utelämnar den här i svaret p.g.a. längd, men du kan använda exakt din version */
</style>
</head>
<body>
<header>
    <nav>
        <a href="#" class="logo" onclick="showPage('hem')">TreeOfLifa</a>
        <ul class="nav-links">
            <li><a href="#" onclick="showPage('hem')">Hem</a></li>
            <li><a href="#" onclick="showPage('om-oss')">Om oss</a></li>
            <li><a href="#" onclick="showPage('produkter')">Produkter</a></li>
        </ul>
        <div class="cart-icon" onclick="toggleCart()">🛒
            <span class="cart-count" id="cart-count">0</span>
        </div>
    </nav>
</header>

<!-- Sidor -->
<div id="hem" class="page active">
    <section class="hero">
        <div class="hero-content fade-in">
            <h1>Naturens Rena Skönhet</h1>
            <p class="subtitle">Upptäck våra handplockade, ekologiska luffasvampar...</p>
            <a href="#" class="cta-button" onclick="showPage('produkter')">Utforska Produkter</a>
        </div>
    </section>
</div>

<div id="om-oss" class="page">
    <section class="section">
        <h2>Vår Berättelse</h2>
        <p>TreeOfLifa grundades ur en passion...</p>
    </section>
</div>

<div id="produkter" class="page">
    <section class="section">
        <h2>Våra Naturliga Luffasvampar</h2>
        <div class="products-grid">
            <div class="product-card fade-in">
                <div class="product-image">🧽</div>
                <div class="product-info">
                    <h3>Klassisk Luffasvamp</h3>
                    <div class="price">149 kr</div>
                    <button class="buy-button" onclick="addToCart('Klassisk Luffasvamp', 149, '🧽')">Lägg i kundvagn</button>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Kundvagn -->
<div class="cart-overlay" id="cart-overlay" onclick="toggleCart()"></div>
<div class="cart-sidebar" id="cart-sidebar">
    <div class="cart-header">
        <h2>Kundvagn</h2>
        <button class="close-cart" onclick="toggleCart()">×</button>
    </div>
    <div class="cart-content" id="cart-content">
        <div class="empty-cart" id="empty-cart">
            <div class="empty-cart-icon">🛒</div>
            <p>Din kundvagn är tom</p>
        </div>
    </div>
    <div class="cart-total" id="cart-total" style="display:none;">
        <div class="total-amount" id="total-amount">Totalt: 0 kr</div>
        <button class="checkout-button" onclick="openPaymentModal()">Fortsätt till betalning</button>
    </div>
</div>

<!-- Betalnings-popup -->
<div id="payment-modal" style="display:none; position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:5000;justify-content:center;align-items:center;">
    <div style="background:#fff;padding:2rem;border-radius:10px;max-width:300px;width:90%;text-align:center;">
        <h3>Välj betalningsmetod</h3>
        <button onclick="checkoutWith('stripe')" style="margin:1rem;width:100%;">💳 Kort (Stripe)</button>
        <button onclick="checkoutWith('klarna')" style="margin:1rem;width:100%;">🛍️ Klarna</button>
        <button onclick="checkoutWith('swish')" style="margin:1rem;width:100%;">📱 Swish</button>
        <button onclick="closePaymentModal()" style="margin-top:1rem;width:100%;">Avbryt</button>
    </div>
</div>

<footer>
    <div class="footer-content">
        <h3>TreeOfLifa</h3>
        <p>Naturlig skönhet, hållbar framtid</p>
    </div>
</footer>

<script>
// Stripe init
const stripe = Stripe('pk_test_51234567890abcdef'); // din publishable key
let cart = [];
let isCartOpen = false;

function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    window.scrollTo(0,0);
}

function addToCart(name, price, emoji) {
    const item = cart.find(i=>i.name===name);
    if(item){item.quantity++} else {cart.push({name, price, emoji, quantity:1})}
    updateCart();
}

function toggleCart() {
    isCartOpen = !isCartOpen;
    document.getElementById('cart-sidebar').classList.toggle('open', isCartOpen);
    document.getElementById('cart-overlay').classList.toggle('show', isCartOpen);
}

function updateCart(){
    const cartContent = document.getElementById('cart-content');
    const emptyCart = document.getElementById('empty-cart');
    const cartTotal = document.getElementById('cart-total');
    const cartCount = document.getElementById('cart-count');
    cartCount.textContent = cart.reduce((s,i)=>s+i.quantity,0);
    if(cart.length===0){
        emptyCart.style.display='block';
        cartTotal.style.display='none';
        cartContent.innerHTML='';
        cartContent.appendChild(emptyCart);
        return;
    }
    emptyCart.style.display='none';
    cartTotal.style.display='block';
    cartContent.innerHTML='';
    let total=0;
    cart.forEach((item,idx)=>{
        total+=item.price*item.quantity;
        const div=document.createElement('div');
        div.classList.add('cart-item');
        div.innerHTML=`<div>${item.emoji} ${item.name} - ${item.price} kr</div>
        <div>
        <button onclick="changeQuantity(${idx},-1)">-</button>
        ${item.quantity}
        <button onclick="changeQuantity(${idx},1)">+</button>
        </div>`;
        cartContent.appendChild(div);
    });
    document.getElementById('total-amount').textContent=`Totalt: ${total} kr`;
}

function changeQuantity(index,delta){
    cart[index].quantity+=delta;
    if(cart[index].quantity<=0){cart.splice(index,1);}
    updateCart();
}

// Betalningsmodal
function openPaymentModal(){
    document.getElementById('payment-modal').style.display='flex';
}
function closePaymentModal(){
    document.getElementById('payment-modal').style.display='none';
}

async function checkoutWith(method){
    try{
        const response = await fetch(`/api/checkout-${method}`,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({items:cart})
        });
        const data = await response.json();
        if(method==='stripe'){
            await stripe.redirectToCheckout({sessionId:data.id});
        } else if(method==='klarna'){
            window.location.href = data.redirectUrl; // backend ska returnera Klarna checkout-url
        } else if(method==='swish'){
            alert("Swish-betalning initierad. Öppna Swish-appen.");
        }
    } catch(err){
        console.error(err);
        alert("Ett fel uppstod vid betalning");
    }
    closePaymentModal();
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TreeOfLifa - Naturliga Luffasvampar</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        /* --- H√§r √§r din original CSS exakt som tidigare --- */
        /* Jag har inte √§ndrat stilarna, bara funktionaliteten i JS */
        /* --- Hela din l√•nga CSS fr√•n originalet h√§r --- */
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="#" class="logo" onclick="showPage('hem')">TreeOfLifa</a>
            <ul class="nav-links">
                <li><a href="#" onclick="showPage('hem')">Hem</a></li>
                <li><a href="#" onclick="showPage('om-oss')">Om oss</a></li>
                <li><a href="#" onclick="showPage('produkter')">Produkter</a></li>
            </ul>
            <div class="cart-icon" onclick="toggleCart()">
                üõí
                <span class="cart-count" id="cart-count">0</span>
            </div>
        </nav>
    </header>

    <!-- Hem Page -->
    <div id="hem" class="page active">
        <!-- ... din original hero och sektion ... -->
    </div>

    <!-- Om oss Page -->
    <div id="om-oss" class="page">
        <!-- ... original text ... -->
    </div>

    <!-- Produkter Page -->
    <div id="produkter" class="page">
        <!-- ... dina produktkort exakt som originalet ... -->
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cart-overlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h2>Kundvagn</h2>
            <button class="close-cart" onclick="toggleCart()">√ó</button>
        </div>
        <div class="cart-content" id="cart-content">
            <div class="empty-cart" id="empty-cart">
                <div class="empty-cart-icon">üõí</div>
                <p>Din kundvagn √§r tom</p>
                <p style="font-size: 0.9rem; color: #999; margin-top: 1rem;">L√§gg till produkter f√∂r att komma ig√•ng!</p>
            </div>
        </div>
        <div class="cart-total" id="cart-total" style="display: none;">
            <div class="total-amount" id="total-amount">Totalt: 0 kr</div>
            
            <button class="checkout-button" onclick="proceedToCheckout()" id="checkout-btn">
                üí≥ Betala med kort (Stripe)
            </button>

            <button class="checkout-button" style="background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);" onclick="proceedToCheckoutKlarna()">
                üõçÔ∏è Betala med Klarna
            </button>

            <button class="checkout-button" style="background: linear-gradient(135deg, #60c960 0%, #4caf50 100%);" onclick="proceedToCheckoutSwish()">
                üì± Betala med Swish
            </button>

            <p style="font-size: 0.9rem; color: #666; margin-top: 1rem;">
                üöö Fri frakt p√• best√§llningar √∂ver 300 kr
            </p>
        </div>
    </div>

    <footer>
        <!-- ... original footer ... -->
    </footer>

    <script>
        const stripe = Stripe('pk_test_51234567890abcdef'); // Ers√§tt med din Stripe publishable key
        let cart = [];
        let isCartOpen = false;

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0,0);
        }

        function addToCart(name, price, emoji) {
            const existingItem = cart.find(i => i.name === name);
            if (existingItem) { existingItem.quantity++; }
            else { cart.push({ name, price, emoji, quantity: 1 }); }
            updateCartDisplay();
            showNotification('‚úÖ Produkt tillagd i kundvagnen!');
        }

        function updateCartDisplay() {
            const cartCount = document.getElementById('cart-count');
            const cartContent = document.getElementById('cart-content');
            const cartTotal = document.getElementById('cart-total');
            const subtotal = cart.reduce((sum, i) => sum + i.price * i.quantity, 0);
            const itemCount = cart.reduce((sum, i) => sum + i.quantity, 0);
            cartCount.textContent = itemCount;
            cartCount.style.display = itemCount > 0 ? 'flex' : 'none';

            if (cart.length === 0) {
                cartContent.innerHTML = `<div class="empty-cart"><div class="empty-cart-icon">üõí</div><p>Din kundvagn √§r tom</p></div>`;
                cartTotal.style.display = 'none';
            } else {
                cartContent.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <div style="display:flex;gap:1rem;">
                            <div style="font-size:2rem;">${item.emoji}</div>
                            <div>
                                <h4>${item.name}</h4>
                                <div>${item.price} kr √ó ${item.quantity}</div>
                            </div>
                        </div>
                        <div>
                            <button onclick="updateQuantity('${item.name}', -1)">‚àí</button>
                            ${item.quantity}
                            <button onclick="updateQuantity('${item.name}', 1)">+</button>
                        </div>
                    </div>
                `).join('');
                cartTotal.style.display = 'block';
                const shippingCost = subtotal >= 300 ? 0 : 49;
                document.getElementById('total-amount').innerHTML = `Totalt: ${subtotal + shippingCost} kr`;
            }
        }

        function updateQuantity(name, change) {
            const item = cart.find(i => i.name === name);
            if (!item) return;
            item.quantity += change;
            if (item.quantity <= 0) cart = cart.filter(i => i.name !== name);
            updateCartDisplay();
        }

        function toggleCart() {
            isCartOpen = !isCartOpen;
            document.getElementById('cart-sidebar').classList.toggle('open', isCartOpen);
            document.getElementById('cart-overlay').classList.toggle('show', isCartOpen);
        }

        function showNotification(msg, type='success') {
            const n = document.createElement('div');
            n.className = 'notification';
            n.textContent = msg;
            if (type === 'error') n.style.background = '#ff6b6b';
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 3000);
        }

        async function proceedToCheckout() {
            if (cart.length === 0) return;
            try {
                const res = await fetch('http://localhost:3000/api/checkout-stripe', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ items: cart, currency: 'sek' })
                });
                const session = await res.json();
                const { error } = await stripe.redirectToCheckout({ sessionId: session.sessionId });
                if (error) throw new Error(error.message);
            } catch (e) {
                showNotification('‚ùå Ett fel uppstod vid Stripe-betalning', 'error');
            }
        }

        async function proceedToCheckoutKlarna() {
            if (cart.length === 0) return;
            try {
                const res = await fetch('http://localhost:3000/api/checkout-klarna', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ items: cart, currency: 'sek' })
                });
                const data = await res.json();
                if (data.redirectUrl) window.location.href = data.redirectUrl;
                else throw new Error('Ingen redirectUrl fr√•n servern');
            } catch (e) {
                showNotification('‚ùå Ett fel uppstod vid Klarna-betalning', 'error');
            }
        }

        async function proceedToCheckoutSwish() {
            if (cart.length === 0) return;
            try {
                const res = await fetch('http://localhost:3000/api/checkout-swish', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ items: cart, currency: 'sek' })
                });
                const data = await res.json();
                if (data.qrCodeUrl) window.location.href = data.qrCodeUrl;
                else throw new Error('Ingen qrCodeUrl fr√•n servern');
            } catch (e) {
                showNotification('‚ùå Ett fel uppstod vid Swish-betalning', 'error');
            }
        }

        updateCartDisplay();
    </script>
</body>
</html>
